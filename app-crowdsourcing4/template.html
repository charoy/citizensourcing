<!-- Template adapted from "Image Template" proposed by PyBossa Community-->
<div class="row" xmlns:https="http://www.w3.org/1999/xhtml">
    <!-- Success and Error Messages for the user -->
    <!-- Success and Error Messages for the user -->
    <div class="span6 offset2" style="height:50px">
        <div id="success" class="alert alert-success" style="display:none;">
            <a class="close">×</a>
            <strong id="i18n_welldone">Well done!</strong> <span
                id="i18n_welldone_text">Your answer has been saved</span>
        </div>
        <div id="loading" class="alert alert-info" style="display:none;">
            <a class="close">×</a>
            <span id="i18n_loading_next_task">Loading next task...</span>
        </div>
        <div id="taskcompleted" class="alert alert-info" style="display:none;">
            <strong id="i18n_task_completed">The task has been completed!</strong> <span
                id="i18n_thanks">Thanks a lot!</span>
        </div>
        <div id="finish" class="alert alert-success" style="display:none;">
            <strong id="i18n_congratulations">Congratulations!</strong> <span id="i18n_congratulations_text">You have participated in all available tasks!</span>
            <br/>

            <div class="alert-actions">
                <a class="btn small" href="/">Go back</a>
                <a class="btn small" href="/project">or, Check other projects</a>
            </div>
        </div>
        <div id="error" class="alert alert-error" style="display:none;">
            <a class="close">×</a>
            <strong>Error!</strong> Something went wrong, please contact the site administrators
        </div>
    </div>
    <!-- End Success and Error Messages for the user -->
</div> <!-- End of Row -->

<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<div class="row skeleton"> <!-- Start Skeleton Row-->
    <div class="span6"><!-- Start of Question and Submission DIV (column) -->
        <!-- Feedback items for the user -->


        <div id="answer"> <!-- Start DIV for the submission buttons -->
            <div class="row" style="margin-top:10px; margin-bottom:10px">
                <div class="span5"><img
                        src="https://raw.githubusercontent.com/charoy/citizensourcing/master/corpus/assess/anchor2.jpg"
                        style="max-width:100%;"></div>
            </div>
            <div class="row" style="margin-top:10px; margin-bottom:10px">
                <div class="span6" style="margin-left:150px">
                    <div id="slider" style="height:150px;cursor:pointer"></div>
                </div>
                <div class="span4">
                <button class="btn btn-primary btn-large btn-answer btn-disqus" style="margin-left:110px;margin-top:10px">submit</button>
                </div>
            </div>
            <div class="row" style="margin-top:10px; margin-bottom:10px">
                <div class="span5"><img
                        src="https://raw.githubusercontent.com/charoy/citizensourcing/master/corpus/assess/anchor1.jpg"
                        style="max-width:100%;"></div>
            </div>


        </div>
    </div>

    <!--
        This project uses Disqus to allow users to provide some feedback.
        The next section includes a button that when a user clicks on it will
        load the comments, if any, for the given task
    -->
    <div class="span6"><!-- Start of Photo DIV (column) -->
        <span id="i18n_working_task">You are working now on task:</span> <span id="task-id"
                                                                               class="label label-warning">#</span>
        <span id="i18n_tasks_completed">You have completed:</span> <span id="done" class="label label-info"></span>
        <span id="i18n_tasks_from">tasks from</span>
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="bar" style="width: 0%;"></div>
        </div>
        <h2 id="question"><span
                id="i18n_question">According to you what is the level of damage in this area ?</span></h2>
        <!-- The question will be loaded here -->
        <div class=""span6" style="margin-top=80px">
        <a id="photo-link" href="#" >
            <img id="photo" src="http://i.imgur.com/GeHxzb7.png" style="max-width=100%">
        </a>
        </div>
        <div id="disqus_show_btn" style="margin-top:5px; display:none">
            <button class="btn btn-primary btn-large btn-disqus" style="display:none"><i
                    class="icon-comments"></i> <span id="i18n_show_comments">Show comments</span></button>
            <button class="btn btn-large btn-disqus" style="display:none"><i class="icon-comments"></i> <span
                    id="i18n_hide_comments">Hide comments</span></button>
        </div>
        <div id="disqus_thread" style="margin-top:5px;display:none"></div>
    </div>
    </div>



    <!-- End of Question and Submission DIV (column) -->

    <!-- End of Skeleton Row -->

    <script type="text/javascript">
        // function loadDisqus() {
        // $("#disqus_thread").toggle();
        // $(".btn-disqus").toggle();
        // var disqus_shortname = 'pybossa'; // required: replace example with your forum shortname
        // //var disqus_identifier = taskId;
        // var disqus_developer = 1;
        // (function() {
        //     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        //     dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        //     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        // })();
        // }
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
        Disqus.</a>
    </noscript>

    <script>
        // Default language
        var userLocale = "en";
        // Translations
        var messages = {
            "en": {
                "i18n_welldone": "Well done!",
                "i18n_welldone_text": "Your answer has been saved",
                "i18n_loading_next_task": "Loading next task...",
                "i18n_task_completed": "The task has been completed!",
                "i18n_thanks": "Thanks a lot!",
                "i18n_congratulations": "Congratulations",
                "i18n_congratulations_text": "You have participated in all available tasks!",
                "i18n_working_task": "You are working now on task:",
                "i18n_tasks_completed": "You have completed:",
                "i18n_tasks_from": "tasks from",
                "i18n_show_comments": "Show comments:",
                "i18n_hide_comments": "Hide comments:",
                "i18n_question": "What is the level of damage in this area ?",
            }
        };
        // Update userLocale with server side information
        $(document).ready(function () {
            userLocale = document.getElementById('PYBOSSA_USER_LOCALE').textContent.trim();
            $("#slider").slider({
                value: 0,
                min: 0,
                max: 50,
                animate: "fast",
                orientation: "vertical"
            });
        });
        function i18n_translate() {
            var ids = Object.keys(messages[userLocale]);
            for (i = 0; i < ids.length; i++) {
                console.log("Translating: " + ids[i]);
                document.getElementById(ids[i]).innerHTML = messages[userLocale][ids[i]];
            }
        }

        function loadUserProgress() {
            pybossa.userProgress('crowdsourcing4').done(function (data) {
                var pct = Math.round((data.done * 100) / data.total);
                $("#progress").css("width", pct.toString() + "%");
                $("#progress").attr("title", pct.toString() + "% completed!");
                $("#progress").tooltip({'placement': 'left'});
                $("#total").text(data.total);
                $("#done").text(data.done);
            });
        }
        pybossa.taskLoaded(function (task, deferred) {
            if (!$.isEmptyObject(task)) {
                // load image from flickr
                var img = $('<img />');
                img.load(function () {
                    // continue as soon as the image is loaded
                    deferred.resolve(task);
                });
                img.attr('src', task.info.img);
                img.addClass('img-polaroid');
                task.info.image = img;
            }
            else {
                deferred.resolve(task);
            }
        });
        pybossa.presentTask(function (task, deferred) {
            console.log("blop bof bof bof !!!!");
            if (!$.isEmptyObject(task)) {
                loadUserProgress();
                // i18n_translate();
                $('#photo-link').html('').append(task.info.image);
                $("#photo-link").attr("href", task.info.img);
                $('#task-id').html(task.id);
                $('.btn-answer').off('click').on('click', function (evt) {
                    var answer = $("#slider").slider("value");
                    $("#slider").slider("value", 0);
                    if (typeof answer != 'undefined') {
                        pybossa.saveTask(task.id, answer).done(function () {
                            deferred.resolve();
                        });
                        $("#loading").fadeIn(500);
                    }
                    else {
                        $("#error").show();
                    }
                });
                $("#loading").hide();
            }
            else {
                $(".skeleton").hide();
                $("#loading").hide();
                $("#finish").fadeIn(500);
            }
        });
        pybossa.run('crowdsourcing4');
    </script>